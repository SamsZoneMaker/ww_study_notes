swpedia_keyword: [shell入门] [shell指令]

author:  houjun.lu@wisewavetech.com  desen.li@wisewavetech.com

---

参考Shell教程：`https://www.runoob.com/linux/linux-shell.html`

# 1. 关于shell

1. Linux 的 Shell 种类众多，常见的有

   - Bourne Shell（/usr/bin/sh或/bin/sh）
   - Bourne Again Shell（/bin/bash）
   - C Shell（/usr/bin/csh）
   - K Shell（/usr/bin/ksh）
   - ...

2. 在ww项目开发工程中，主要是使用Bash。在一般情况下，人们并不区分 Bourne Shell 和 Bourne Again Shell，所以，像 **#!/bin/sh**，它同样也可以改为 **#!/bin/bash**。其中，**#!**告诉系统其后路径所指定的程序即是解释此脚本文件的 Shell 程序。

3. 如何执行shell脚本：主要有两种方式

   - 1、作为可执行程序：`./build.sh` or `bash build.sh`

     | 命令     | 是否需要子 Shell | 是否需要执行权限 | 是否影响当前 Shell | 使用场景                         |
     | -------- | ---------------- | ---------------- | ------------------ | -------------------------------- |
     | `./`     | 是               | 是               | 否                 | 独立运行脚本，不影响当前环境     |
     | `bash`   | 是               | 否               | 否                 | 用 Bash 运行脚本，不影响当前环境 |
     | `.`      | 否               | 否               | 是                 | 加载脚本内容到当前环境           |
     | `source` | 否               | 否               | 是                 | 与`.`一样，习惯问题              |

     注意事项：

     1. 执行权限：

        - 使用 `./` 时，脚本需要有执行权限，可以通过 `chmod +x build.sh` 添加。

        - 使用 `source`、`.` 或 `bash` 不需要脚本有执行权限。

     2. 变量和作用域：

        - `source` 和 `.` 会影响当前环境，因此慎用它们以免污染环境。比如在ww项目中使用`source setup_env.sh`加载环境变量。

        - `./` 和 `bash` 是推荐方式，尤其在希望脚本独立运行时。

   - 2、作为解释器参数：

     这种运行方式是，直接运行解释器，其参数就是 shell 脚本的文件名，如：

     ```
     /bin/sh test.sh
     /bin/php test.php
     ```

     这种方式运行的脚本，不需要在第一行指定解释器信息，写了也没用。

# 2. Shell入门

## 1、变量

1. 定义变量：如`your_name="runoob"`。在Shell中所有变量（无论是数字还是字符串）都可以看作是字符串。

2. 使用变量：使用一个定义过的变量，只要在变量名前面加`$`即可。

   - 举例：`echo $name`，`echo ${name}`。变量名外面的花括号是可选的，加不加都行，加花括号是为了帮助解释器识别变量的边界。

   - 在判断时使用$1等，一般会加上`""`双引号，这样在$1为空时不会出错。

3. 只读变量：`readonly name`可以将变量定义为只读变量，只读变量的值不能被改变。

4. 删除变量：`unset name`可以删除变量，但是不能删除只读变量。

5. 变量类型：

   - 字符串变量：`'name' or "name"`

   - 整数变量：`declare -i or typeset -i`

   - 数组变量：
     - 整数数组：`arry=(1 2 3)`
     - 关联数组：`declare -A or typeset -A`

   - 环境变量：
     - `$PATH`，定义了系统查找可执行程序的路径列表。
     - `$HOME`，当前用户主目录。
     - `$SHELL`，shell程序的路径。

   - 特殊变量： 有一些特殊变量在 Shell 中具有特殊含义，例如 `$0` 表示脚本的名称，`$1`, `$2`, 等表示脚本的参数。`$#`表示传递给脚本的参数数量，`$?` 表示上一个命令的退出状态等。

6. 注意：在Shell中，所有变量都是默认**字符串**的形式进行存储的。但是根据代码中使用的上下文，在特定场景中表现为整数或者其他类型。
   - 比如在使用`x=12 y=21 result=$((x + y))`进行运算的时候，这个时候的变量呗视为整数。

## 2、数组

1. 读取数组：

   - 一般格式：`${数组名[下标]}`。

   - 使用`@`：`${数组名[@]}`读取数组中所有元素。


2. 获取数组长度：

   - `length=${#array_name[@]}`，其中`#`用于获取字符串变量的长度。

   - `length=${#array_name[*]}`，`*`和`@`的作用相同，都可以用来表示全部的数组。


3. 关联数组：Bash 支持关联数组，可以使用任意的字符串、或者整数作为下标来访问数组元素。
   - 可以使用关联数组实现伪二维数组（shell本身并不支持二维数组）。
   - 变量命名前需要使用`declare -A xxx`进行声明。
   - 关联数组中可以使用任意的字符串、或者整数作为下标来访问数组元素。对于实现伪二维数组`xxx["x,x"]`这样来进行命名。
   - 删除中间的数据也是使用`unset`将元素变为空元素。

## 3、运算符

### **1. 算术运算符**

| 运算符 | 描述             | 示例         | 结果    |
| ------ | ---------------- | ------------ | ------- |
| `+`    | 加法             | `$((a + b))` | `a + b` |
| `-`    | 减法             | `$((a - b))` | `a - b` |
| `*`    | 乘法             | `$((a * b))` | `a * b` |
| `/`    | 除法（整数除法） | `$((a / b))` | `a / b` |
| `%`    | 取模（余数）     | `$((a % b))` | `a % b` |

### **2. 关系运算符**

| 运算符 | 描述               | 示例          | 结果              |
| ------ | ------------------ | ------------- | ----------------- |
| `-eq`  | 检查是否相等       | `[ a -eq b ]` | `true` 或 `false` |
| `-ne`  | 检查是否不相等     | `[ a -ne b ]` | `true` 或 `false` |
| `-gt`  | 检查是否大于       | `[ a -gt b ]` | `true` 或 `false` |
| `-lt`  | 检查是否小于       | `[ a -lt b ]` | `true` 或 `false` |
| `-ge`  | 检查是否大于或等于 | `[ a -ge b ]` | `true` 或 `false` |
| `-le`  | 检查是否小于或等于 | `[ a -le b ]` | `true` 或 `false` |

### **3. 布尔运算符**

| 运算符 | 描述          | 示例                     | 结果              |
| ------ | ------------- | ------------------------ | ----------------- |
| `!`    | 逻辑非        | `[ ! false ]`            | `true`            |
| `-a`   | 逻辑与（AND） | `[ a -gt 0 -a b -gt 0 ]` | `true` 或 `false` |
| `-o`   | 逻辑或（OR）  | `[ a -gt 0 -o b -gt 0 ]` | `true` 或 `false` |

### **4. 字符串运算符**

| 运算符 | 描述                   | 示例               | 结果              |
| ------ | ---------------------- | ------------------ | ----------------- |
| `=`    | 检查字符串是否相等     | `[ "$a" = "$b" ]`  | `true` 或 `false` |
| `!=`   | 检查字符串是否不相等   | `[ "$a" != "$b" ]` | `true` 或 `false` |
| `-z`   | 检查字符串长度是否为零 | `[ -z "$a" ]`      | `true` 或 `false` |
| `-n`   | 检查字符串长度是否非零 | `[ -n "$a" ]`      | `true` 或 `false` |

### **5. 文件测试运算符**

| 运算符 | 描述                       | 示例          | 结果              |
| ------ | -------------------------- | ------------- | ----------------- |
| `-e`   | 文件是否存在               | `[ -e file ]` | `true` 或 `false` |
| `-f`   | 文件是否为普通文件         | `[ -f file ]` | `true` 或 `false` |
| `-d`   | 文件是否为目录             | `[ -d dir ]`  | `true` 或 `false` |
| `-r`   | 文件是否可读               | `[ -r file ]` | `true` 或 `false` |
| `-w`   | 文件是否可写               | `[ -w file ]` | `true` 或 `false` |
| `-x`   | 文件是否可执行             | `[ -x file ]` | `true` 或 `false` |
| `-s`   | 文件是否非空（大小大于 0） | `[ -s file ]` | `true` 或 `false` |

## 4、echo命令

```bash
# 显示普通字符串 
echo "wisewavetech"
# 显示转义字符串
echo "\"wisewavethech\""
# 显示变量
echo "It is variable ${x}"
# 显示换行(使用 -e 开启转义)
echo -e "wisewavetech \n"
# 显示不换行(使用 -e 开启转义)
echo -e "wisewavetech \c"
```

## 5、控制流程

### if else语句格式

```bash
# 使用[ ... ]作为判断语句
if [ conditon ]; then
	command
elif [ condition ]; then
	command
else
	command
fi
# 使用(( ... ))作为判断语句
if (( condition )); then
	command
elif (( condition )); then
	command
else
	command
fi
```

### for语句格式

```bash
for loop in 1 2 3 4 5; do
	command
done

for (( i=1;i<=5;i++ )); do
	command
done
```

### while语句格式

```bash
while (( i=1;i<=5;i++ )); do
	command
done
```

### case ... esac语句格式

```bash
case value in
mode 1)
    command1
    command2
    ...
    commandN
    ;;
mode 2)
    command1
    command2
    ...
    commandN
    ;;
esac
```

### 区分`[]`和`(())`

| 特性                 | `[]`                       | `(())`                         |
| -------------------- | -------------------------- | ------------------------------ |
| **主要用途**         | 条件测试（字符串、文件等） | 数学运算与整数条件测试         |
| **运算符**           | `-eq, -ne, -gt, -lt` 等    | `==, !=, >, <, >=, <=, ++, --` |
| **变量是否需要 `$`** | 需要                       | 不需要（但支持 `$`）           |
| **支持的类型**       | 字符串、整数、文件状态     | 整数（不支持字符串或浮点数）   |
| **数学运算支持**     | 不支持                     | 支持                           |

1. `[]`使用注意事项： 

   - 是 `test` 命令的简化形式，写作 `[ condition ]`。

   - 空格敏感：
     - 在使用`[]`的时候，condition的左右一定要有空格`[ condition ]`，`[ ${x} -eq 1 ]`
   - 字符串比较：
     - 使用 `=` 进行相等比较，`!=` 进行不等比较。
     - 必须将变量用引号包裹，避免空值导致错误。
   - 整数比较：
     - 需要用 `-eq`（等于）、`-ne`（不等于）、`-gt`（大于）、`-lt`（小于）等符号，而不能用 `>` 或 `<`。

2. `(())`使用注意事项：
   - 通常用于需要执行数学运算或整数判断的场景。
   - 不能直接用于字符串比较。



# 3. 指令用法

## find

**语法**：

`find [路径] [匹配条件] [动作]`

**路径** 是要查找的目录路径，可以是一个目录或文件名，也可以是多个路径，多个路径之间用空格分隔，如果未指定路径，则默认为当前目录。

**匹配条件** （可选）有多种参数，以下列举部分常用的参数：

- `-name pattern`：按文件名查找，支持使用通配符 `*` 和 `?`
- `-type type`：按文件类型查找，可以是 `f`（普通文件）、`d`（目录）、`l`（符号链接）等
- `-mtime days`：按修改时间查找，支持使用 `+` 或 `-` 表示在指定天数前或后，days 是一个整数表示天数

**动作:** 可选的，用于对匹配到的文件执行操作，比如删除、复制等。



**一些实例**：

- 查找当前目录下名为 file.txt 的文件：`find . -name file.txt`
- 将当前目录及其子目录下所有文件后缀为 **.c** 的文件列出来: `find . -name "*.c"`
- 查找 /var/log 目录下在 7 天前修改过的文件：`find /var/log -mtime +7`
- 在当前目录下查找最近 20 天内状态发生改变的文件和目录: `# find . -ctime  20`

